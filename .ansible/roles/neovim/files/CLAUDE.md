# Claude Code グローバル設定

## 基本設定
- Claude Code による回答は、必ず日本語でお願いします。

## ワークフロールール

### TODOリストとレビュー
- TODOリストの全タスクが完了したら、**必ずサブエージェントを使ってコードレビューを実施する**

#### Ansibleファイルのレビュー（.ansible/roles/配下を変更した場合）
1. `ansible-validator` サブエージェントで構文・ベストプラクティスをチェック
2. `infra-reviewer` サブエージェントでセキュリティ・保守性をレビュー
3. 問題があれば修正してから次へ進む

#### Railsファイルのレビュー（Railsプロジェクトを変更した場合）
1. **コード品質**: `rails-code-reviewer` サブエージェントでRails規約・アンチパターンをチェック
2. **セキュリティ**: `rails-security-auditor` サブエージェントで脆弱性を検出
3. **パフォーマンス** (必要に応じて): `rails-performance-optimizer` サブエージェントでN+1問題等を検出
4. **マイグレーション** (db/migrate/変更時): `rails-db-migration-reviewer` サブエージェントで安全性を確認
5. **テスト** (spec/変更時): `rails-test-guardian` サブエージェントでテストを実行

#### ドキュメント更新
- コード変更後、`docs-updater` サブエージェントで関連ドキュメント(README、CLAUDE.md等)を更新

#### レビューの基本フロー
1. 変更したファイルの一覧を表示
2. 適切なサブエージェントを起動してレビュー実施
3. サブエージェントの指摘事項を確認・修正
4. 変更内容の要約を提示

### 効率化ルール
- コミットメッセージは変更内容から自動生成する
- 複数ファイルの読み込みや検索は並列で実行する
- overview → symbol → 詳細と段階的に情報収集し、既読ファイルは再読み込みしない

### テスト実行ルール
#### テストファイルを編集した場合
1. **即座にテストを実行する（ユーザーに依頼しない）**
   - 編集したテストファイルを実行
   - 例: `bundle exec rspec <編集したファイルパス>` (Rails/RSpec)
2. テスト結果をユーザーに報告する
3. 失敗した場合は原因を調査し、修正する

#### 実装ファイルを編集した場合
1. **関連するテストを実行する（ユーザーに依頼しない）**
   - 例: `bundle exec rspec spec/<関連するテストファイル>` (Rails/RSpec)
2. テスト結果をユーザーに報告する

### 変更の原則
- 明示的に依頼されない限り、不要なリファクタリングは避ける
- 変更前に影響範囲を調査し、既存テストの有無を確認
- プロジェクトのコーディング規約・ディレクトリ構造に従う
- コード変更時は関連ドキュメント（README、CLAUDE.md等）も必要に応じて更新

### ドキュメント更新の原則
- **プロジェクトCLAUDE.md**（リポジトリ直下やプロジェクトルート）はチーム全体に影響するため、**必ずユーザーに確認してから更新する**
- **グローバルCLAUDE.md**（~/.claude/CLAUDE.md）は個人設定なので自由に更新可能
- プロジェクトREADME.mdも重要なドキュメントのため、更新前に変更内容を提示する
- ロール配下のREADMEやドキュメントは、変更が明確な場合のみ自動更新可

### PRディスクリプション
- PRのディスクリプションを考える時は、PRテンプレートがある場合は必ずテンプレートを参考にすること

### エラー対応
- エラーが発生したら即座に報告し、対処方法をユーザーと相談
- 繰り返し同じエラーで失敗する場合は、別のアプローチを提案
