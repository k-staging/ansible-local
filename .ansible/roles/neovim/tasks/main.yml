---
- name: create directory
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    mode: 0755
  with_items:
    - "{{ neovim_dir }}"

- name: install neovim (mac)
  block:
    - name: download neovim (mac)
      ansible.builtin.unarchive:
        src: "https://github.com/neovim/neovim/releases/download/v{{ neovim_version }}/nvim-macos.tar.gz"
        dest: "/usr/local/src/nvim/"
        remote_src: yes
        extra_opts: ["--strip-components=1"]
  when: ansible_distribution == 'MacOSX' 

- name: download neovim (linux)
  ansible.builtin.unarchive:
    src: "https://github.com/neovim/neovim/releases/download/v{{ neovim_version }}/nvim-linux64.tar.gz"
    dest: "/usr/local/src/nvim/"
    remote_src: yes
    extra_opts: ["--strip-components=1"]
  when: ansible_distribution == 'Ubuntu' 

- name: create neovim symlink
  ansible.builtin.file:
    src: "/usr/local/src/nvim/bin/nvim"
    dest: "/usr/local/bin/nvim"
    state: link
    force: yes
  become: yes

- name: copy init.vim
  ansible.builtin.copy:
    src: "init.vim"
    dest: "~/.config/nvim/init.vim"

- name: copy config.yml.j2
  ansible.builtin.template:
    src: "config.yml.j2"
    dest: "~/.config/sqls/config.yml"

- name: install neovim plugin
  ansible.builtin.git:
    repo: "https://github.com/{{ item }}.git"
    dest: "{{ neovim_plugin_path }}/{{ item.split('/')[-1] }}"
    update: no
  with_items:
    - "{{ neovim_plugins }}"

- name: install fzf
  ansible.builtin.shell: ./install --all
  args:
    chdir: "{{ neovim_plugin_path }}/fzf"

- name: copy .NERDTreeBookmarks
  ansible.builtin.template:
    src: .NERDTreeBookmarks.j2
    dest: ~/.NERDTreeBookmarks
    mode: 0644

- name: download ctags
  ansible.builtin.git:
    repo: "https://github.com/universal-ctags/ctags.git"
    dest: "/usr/local/src/ctags"
    update: no

- name: execute autogen.sh
  ansible.builtin.shell: ./autogen.sh
  args:
    chdir: "/usr/local/src/ctags"

- name: execute configure
  ansible.builtin.shell: ./configure
  args:
    chdir: "/usr/local/src/ctags"

- name: make ctags
  community.general.make:
    chdir: "/usr/local/src/ctags"

- name: make install ctags
  community.general.make:
    chdir: "/usr/local/src/ctags"
    target: install
  become: yes

- name: download plantuml
  ansible.builtin.get_url:
    url: "https://jaist.dl.sourceforge.net/project/plantuml/1.2021.12/plantuml.1.2021.12.jar"
    dest: "~/lib/java/plantuml.jar"
    mode: 0755

- name: copy plantuml
  ansible.builtin.copy:
    src: "plantuml"
    dest: "/usr/local/bin/plantuml"
    mode: 0755

- name: create java symlink
  ansible.builtin.file:
    src: "/usr/local/opt/openjdk/libexec/openjdk.jdk"
    dest: "/Library/Java/JavaVirtualMachines/openjdk.jdk"
    state: link
  when: ansible_distribution == 'MacOSX' 

